var Pe=Object.defineProperty,Ue=(t,e)=>()=>(t&&(e=t(t=0)),e),Me=(t,e)=>{for(var o in e)Pe(t,o,{get:e[o],enumerable:!0})},Se={};Me(Se,{default:()=>Ae});function Re(t){if(t.log.once("AXE","AXE relay enabled! :-)))))"),t.window)console.log("+AXE Client side"),t.on("opt",function(e){let o=e.opt,u=o.peers;if(o.axe===!1)return;let r=t.window,n=r.localStorage||o.localStorage||{},a=r.location||o.location||{};r.navigator||o.navigator;let h=e.axe={},l,f;o.mesh=o.mesh||t.Mesh(e);function y(w){l=u[f=w]=u[f]||{},l.id=l.url=f,l.retry=l.retry||0}y(`${a.origin}/gun`),y("http://localhost:8765/gun"),y(" https://gun-manhattan.herokuapp.com/gun"),t.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),t.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!"),e.on("bye",function(w){this.to.next(w)}),e.on("hi",function(w){this.to.next(w)});async function g(){let w=((a.search||"").split("axe=")[1]||"").split("&")[0]||a.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md",v=await(await fetch(w)).text();n.peers=v,h.fall={},(v.match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(p=>{h.fall[p]={url:p,id:p,retry:0}})}g().catch(w=>console.log(w.message)),this.to.next(e)});else{console.log("+AXE Server side");let e;t.on("opt",function(u){console.log("Gun OPT");let r=u.opt;if(r.peers,r.axe===!1||typeof process<"u"&&`${(process.env||"").AXE}`=="false")return;t.log.once("AXE","AXE relay enabled!");let n=u.axe={},a=r.mesh=r.mesh||t.Mesh(u),h=u.dup;a.way=function(i){if(i){if(i.get)return l(i);i.put||f(i)}};function l(i){if(!i)return;let c=(i._||"").via,d;if(!c||!c.id||!(d=y(i)._))return f(i);d.asked=+new Date,l.turn(i,d.route,0)}l.turn=function(i,c,d){let s=i["#"],m=h.s[s],k;if(!(!s||!m)&&(clearTimeout(m.lack),!(m.ack&&(s=m["##"])&&i["##"]===s))){if(k=Object.maps(c||r.peers).slice(d=d||0),!k.length){if(!c)return;l.turn(i,e,0);return}setTimeout.each(k,function(b){let S=r.peers[b];if(d++,!S||!S.wire){c&&c.delete(b);return}if(a.say(i,S)!==!1&&d%3==0)return 1},function(){m["##"]=i["##"],m.lack=setTimeout(function(){l.turn(i,c,d)},25)},3)}};function f(i){a.say(i,r.peers)}function y(i){let c="",d,s,m;if(!i||!i.get)return c;typeof(d=i.get["#"])=="string"&&(c=u.$.get(d)),typeof(m=i.get["."])=="string"?s=m:s="";let k=(i._||"").via,b=k.sub||(k.sub=new Object.Map);return(b.get(d)||b.set(d,m=new Object.Map)&&m).set(s,1),k.id&&c._&&(c._.route||(c._.route=new Object.Map)).set(k.id,k),c}function g(i){return(i=i||"")["="]||i["*"]||i[">"]||i}u.on("in",function(i){let c=this.to,d;if((d=i["@"])&&(d=h.s[d])){if(d.ack=(d.ack||0)+1,d.it&&d.it.get&&i.put){let s=d.it.get||"",m=y(d.it)._,k=(d.it._||"").via||"",b;if(k&&m&&(k.id&&(m.route||(m.route=new Object.Map)).set(k.id,k),b=k.sub||(k.sub=new Object.Map),m&&(b.get(g(s["#"]))||b.set(g(s["#"]),b=new Object.Map)&&b).set(g(s["."]),1),k=(i._||"").via||"",k&&(k.id&&(m.route||(m.route=new Object.Map)).set(k.id,k),b=k.sub||(k.sub=new Object.Map),m))){let S=g(s["#"]),A=b.get(S),_=g(s["."]);_?(A||b.set(S,A=new Object.Map)&&A).set(_,1):A||(b.set(S,A=new Object.Map),A.set("",1))}}if(d=d.back){setTimeout.each(Object.keys(d),function(s){c.next({"#":i["#"],"@":s,ok:i.ok})});return}}c.next(i)}),u.on("create",function(i){this.to.next(i),i.on("put",function(c){let d=this;d.as;let s=c.put,m=s["#"],k=s["."],b=s[":"],S=s[">"];if(d.to.next(c),c["@"]||!m||!k)return;let A=i.$.get(m)._,_=(A||"").route;if(_){if(A.skip){A.skip.now=c["#"];return}(A.skip={now:c["#"]}).to=setTimeout(function(){setTimeout.each(Object.maps(_),function(T){var O,B;let j=A.skip||"";if(A.skip=null,!(O=_.get(T)))return;if(!O.wire){_.delete(T);return}let E=(O.sub||(O.sub=new Object.Map)).get(m);if(!E||!E.get(k)&&!E.get(""))return;let D=O.put||(O.put={}),N=i.graph[m];var B;N&&e!==(B=N[k])&&(S=p(N,k),b=B),D[m]=v(D[m],k,S,b,m),B=h.track(O.next=O.next||String.random(9)),(B.back||(B.back={}))[`${j.now}`||c["#"]]=1,!O.to&&(O.to=setTimeout(function(){w(O)},r.gap))})},9)}})});function w(i){let c={"#":i.next,put:i.put,ok:{"@":3,"/":a.near}};i.next=i.put=i.to=null,a.say(c,i)}let v=t.state.ify,p=t.state.is;(function(){n.up={};let i=a.hear["?"];a.hear["?"]=function(c,d){let s;if(i(c,d),!!d.pid){if(d.pid===r.pid){a.bye(d);return}if(s=n.up[d.pid]){if(s===d)return;r.pid>d.pid&&(s=d,d=n.up[s.pid]),s.url=s.url||d.url,a.bye(d),n.up[s.pid]=s;return}!d.url||(n.up[d.pid]=d,n.stay&&n.stay())}},a.hear.opt=function(c,d){if(c.ok)return;let s=c.opt;!s||(s=s.peers,!(!s||typeof s!="string")&&(Object.keys(n.up).length>=99||(a.hi({id:s,url:s,retry:9}),d&&a.say({dam:"opt",ok:1,"@":c["#"]},d))))},n.stay=function(){clearTimeout(n.stay.to),n.stay.to=setTimeout(function(c,d){!(c=u.stats&&u.stats.stay)||(d={},Object.keys(n.up||"").forEach(function(s){s=(n.up||"")[s],s.url&&(d[s.url]={})}),(c.axe=c.axe||{}).up=d)},1e3*9)},setTimeout(function(c){!(c=u.stats&&u.stats.stay&&u.stats.stay.axe)||!(c=c.up)||(c instanceof Array||(c=Object.keys(c)),setTimeout.each(c||[],function(d){a.hear.opt({opt:{peers:d}})}))},1e3)})(),function(){r.mob=r.mob||9900,u.on("hi",function(i){if(this.to.next(i),i.url)return;let c=a.near;if(r.mob>=c)return;let d={};Object.keys(n.up).forEach(function(s){s=n.up[s],s.url&&(d[s.url]={})}),a.say({dam:"mob",mob:c,peers:d},i),setTimeout(function(){a.bye(i)},9)}),u.on("bye",function(i){this.to.next(i)})}(),this.to.next(u)});let o=Array.from;Object.maps=u=>o&&u instanceof Map?o(u.keys()):(u instanceof Object.Map&&(u=u.s),Object.keys(u)),o&&(Object.Map=Map),(Object.Map=function(){this.s={}}).prototype={set:function(u,r){return this.s[u]=r,this},get:function(u){return this.s[u]},delete:function(u){delete this.s[u]}}}}var Ae,Ie=Ue(()=>{Ae=Re});String.random=function(t,e){let o="";for(t=t||24,e=e||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t-- >0;)o+=e.charAt(Math.floor(Math.random()*e.length));return o};String.match=function(t,e){let o,u;return typeof t!="string"?!1:(typeof e=="string"&&(e={"=":e}),e=e||{},o=e["="]||e["*"]||e[">"]||e["<"],t===o?!0:u!==e["="]?!1:(o=e["*"]||e[">"],t.slice(0,(o||"").length)===o?!0:u!==e["*"]?!1:u!==e[">"]&&u!==e["<"]?t>=e[">"]&&t<=e["<"]:u!==e[">"]&&t>=e[">"]||u!==e["<"]&&t<=e["<"]))};String.hash=function(t,e){if(typeof t=="string"){if(e=e||0,!t.length)return e;for(let o=0,u=t.length,r;o<u;++o)r=t.charCodeAt(o),e=(e<<5)-e+r,e|=0;return e}};var _e=Object.prototype.hasOwnProperty;Object.plain=function(t){return t?t instanceof Object&&t.constructor===Object||Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1]==="Object":!1};Object.empty=function(t,e){for(let o in t)if(_e.call(t,o)&&(!e||e.indexOf(o)==-1))return!1;return!0};Object.keys=Object.keys||function(t){let e=[];for(let o in t)_e.call(t,o)&&e.push(o);return e};(function(){let t,e=setTimeout,o=0,u=0,r=typeof setImmediate!=`${t}`&&setImmediate||e;e.hold=e.hold||9,e.poll=e.poll||function(n){if(e.hold>=+new Date-o&&u++<3333){n();return}r(function(){o=+new Date,n()},u=0)}})();var oe=setTimeout,xe=oe.turn=oe.turn||function(t){L.push(t)===1&&Te($e)},L=xe.s=[],Te=oe.poll,X=0,fe,$e=()=>{(fe=L[X++])&&fe(),(X===L.length||X===99)&&(L=xe.s=L.slice(X),X=0),L.length&&Te($e)};(function(){let t,e=setTimeout,o=e.turn;(e.each=e.each||function(u,r,n,a){a=a||9,function h(l,f,y){if(f=(l=(u||[]).splice(0,a)).length){for(let g=0;g<f&&t===(y=r(l[g]));g++);if(t===y){o(h);return}}n&&n(y)}()})()})();function Je(t){let e={s:{}},o=e.s;t=t||{max:999,age:1e3*9};let u=e.track=r=>{let n=o[r]||(o[r]={});return n.was=e.now=+new Date,e.to||(e.to=setTimeout(e.drop,t.age+9)),n};return e.check=r=>o[r]?u(r):!1,e.drop=function(r){e.to=null,e.now=+new Date;let n=Object.keys(o);console.STAT&&console.STAT(e.now,+new Date-e.now,"dup drop keys"),setTimeout.each(n,a=>{let h=o[a];h&&(r||t.age)>e.now-h.was||delete o[a]},0,99)},e}var He=Je;function R(t,e,o){if(!t)return{to:R};let u,r=typeof e=="function";if(t=(this.tag||(this.tag={}))[t]||r&&(this.tag[t]={tag:t,to:R._={next:function(n){let a;(a=this.to)&&a.next(n)}}}),r){let n={off:R.off||(R.off=function(){if(this.next===R._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=R._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:R._,next:e,the:t,on:this,as:o};return(n.back=t.last||t).to=n,t.last=n}return(t=t.to)&&u!==e&&t.next(e),t}var Ke=R,Le=String.random||function(){return Math.random().toString(36).slice(2)};function We(t,e){if(!this.on)return;let o=(this.opt||{}).lack||9e3;if(typeof t!="function"){if(!t)return;let n=t["#"]||t,a=(this.tag||"")[n];return a?(e&&(a=this.on(n,e),clearTimeout(a.err),a.err=setTimeout(function(){a.off()},o)),!0):void 0}let u=e&&e["#"]||Le(9);if(!t)return u;let r=this.on(u,t,e);return r.err=r.err||setTimeout(function(){r.off(),r.next({err:"Error: No ACK yet.",lack:!0})},o),u}var Fe=We;function Xe(t){return t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"&&t!==1/0&&t!==-1/0&&t===t||!!t&&typeof t["#"]=="string"&&Object.keys(t).length===1&&t["#"]}var ce=0,qe=999,z=-1/0,le;function W(){let t=+new Date;return z<t&&(ce=0,z=t+W.drift),z=t+(ce+=1)/qe+W.drift,z}W.drift=0;W.is=(t,e,o)=>{let u=e&&t&&t._&&t._[">"]||o;if(u)return typeof(u=u[e])=="number"?u:-1/0};W.ify=(t,e,o,u,r)=>{(t=t||{})._=t._||{},r&&(t._["#"]=r);let n=t._[">"]||(t._[">"]={});return le!==e&&e!=="_"&&(typeof o=="number"&&(n[e]=o),le!==u&&(t[e]=u)),t};var ze=W;function $(t){return t instanceof $?(this._={$:this}).$:this instanceof $?$.create(this._={$:this,opt:t}):new $(t)}function F(t){if(!t)return;if(t.out===F){this.to.next(t);return}let e=this,o=e.as,u=o.at||o,r=u.$,n=u.dup,a,h=t.DBG;if((a=t["#"])||(a=t["#"]=ie(9)),!n.check(a)){if(n.track(a),a=t._,t._=typeof a=="function"?a:function(){},t.$&&t.$===(t.$._||"").$||(t.$=r),t["@"]&&!t.put&&Ve(t),!u.ask(t["@"],t))if(h&&(h.u=+new Date),t.put){Oe(t);return}else t.get&&$.on.get(t,r);h&&(h.uc=+new Date),e.to.next(t),h&&(h.ua=+new Date),t.out=F,u.on("out",t),h&&(h.ue=+new Date)}}function Oe(t){if(!t)return;let e=t._||"",o=e.root=((e.$=t.$||"")._||"").root;if(t["@"]&&e.faith&&!e.miss){t.out=F,o.on("out",t);return}e.latch=o.hatch,e.match=o.hatch=[];let u=t.put,r=e.DBG=t.DBG,n=+new Date;if(V=V||n,u["#"]&&u["."])return;r&&(r.p=n),e["#"]=t["#"],e.msg=t,e.all=0,e.stun=1;let a=Object.keys(u);console.STAT&&console.STAT(n,((r||e).pk=+new Date)-n,"put sort");let h=0,l,f,y,g,w,v,p;(function i(c){if(l!=h){if(l=h,!(y=a[h])){console.STAT&&console.STAT(n,((r||e).pd=+new Date)-n,"put"),Y(e);return}(g=u[y])?(p=g._)?y!==p["#"]?v=`${K+M(y)}soul not same.`:(w=p[">"])||(v=`${K+M(y)}no state.`):v=`${K+M(y)}no meta.`:v=`${K+M(y)}no node.`,f=Object.keys(g||{})}if(v){t.err=e.err=v,Y(e);return}let d=0,s;for(c=c||0;c++<9&&(s=f[d++]);){if(s==="_")continue;let m=g[s],k=w[s];if(ee===k){v=`${K+M(s)}on${M(y)}no state.`;break}if(!et(m)){v=`${K+M(s)}on${M(y)}bad ${typeof m}${M(m)}`;break}De(m,s,y,k,t),++G}if((f=f.slice(d)).length){Qe(i);return}++h,f=null,i(c)})()}function De(t,e,o,u,r){let n=r._||"",a=n.root,h=a.graph,l,f=h[o]||tt,y=ae(f,e,1),g=f[e],w=n.DBG;(l=console.STAT)&&(!h[o]||!g)&&(l.has=(l.has||0)+1);let v=Ze();if(u>v){setTimeout(()=>{De(t,e,o,u,r)},(l=u-v)>ge?ge:l),console.STAT&&console.STAT((w||n).Hf=+new Date,l,"future");return}if(u<y&&!n.miss||!n.faith&&u===y&&(t===g||he(t)<=he(g))&&!n.miss)return;n.stun++;let p=r["#"]+n.all++,i={toString:function(){return p},_:n};i.toJSON=i.toString,a.dup.track(i)["#"]=r["#"],w&&(w.ph=w.ph||+new Date),a.on("put",{"#":i,"@":r["@"],put:{"#":o,".":e,":":t,">":u},_:n})}function Ye(t){let e;(e=(t._||"").DBG)&&(e.pa=+new Date,e.pm=e.pm||+new Date);let o=this,u=o.as,r=u.graph,n=t._,a=t.put,h=a["#"],l=a["."],f=a[":"],y=a[">"];t["#"];let g;(g=n.msg)&&(g=g.put)&&(g=g[h])&&Z(g,l,y,f,h),r[h]=Z(r[h],l,y,f,h),(g=(u.next||"")[h])&&g.on("in",t),Y(n),o.to.next(t)}function Y(t,e){let o;if(t.stop||!t.err&&--t.stun>0||(t.stop=1,!(o=t.root)))return;let u=t.match;u.end=1,u===o.hatch&&(!(u=t.latch)||u.end?delete o.hatch:o.hatch=u),t.hatch&&t.hatch(),setTimeout.each(t.match,function(r){r&&r()}),!(!(e=t.msg)||t.err||e.err)&&(e.out=F,t.root.on("out",e),Ee())}function pe(t){!t||!t.root||t.stun||t.acks!==t.all||t.root.on("in",{"@":t["#"],err:t.err,ok:t.err?ee:{"":1}})}function Ve(t){let e=t["@"]||"",o;if(!(o=e._)){var u=(u=t.$)&&(u=u._)&&(u=u.root)&&(u=u.dup);if(!(u=u.check(e)))return;t["@"]=u["#"]||t["@"];return}o.acks=(o.acks||0)+1,(o.err=t.err)&&(t["@"]=o["#"],Y(o)),!o.stop&&!o.crack&&(o.crack=o.match&&o.match.push(function(){pe(o)})),pe(o)}$.is=t=>t instanceof $||t&&t._&&t===t._.$||!1;$.version=.2022;$.chain=$.prototype;$.chain.toJSON=()=>{};$.valid=Xe;$.state=ze;$.on=Ke;$.dup=He;$.ask=Fe;$.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||$.on,t.ask=t.ask||$.ask,t.dup=t.dup||$.dup();let e=t.$.opt(t.opt);return t.once||(t.on("in",F,t),t.on("out",F,t),t.on("put",Ye,t),$.on("create",t),t.on("create",t)),t.once=1,e};$.on.put=Oe;var K="Error: Invalid graph!",M=t=>` '${`${t}`.slice(0,9)}...' `,he=JSON.stringify,ge=2147483647,Ze=$.state,G=0,V,Ee=()=>{G>999&&G/-(V-(V=+new Date))>1&&($.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),Ee=()=>{G=0})};$.on.get=function(t,e){let o=e._,u=t.get,r=u["#"],n=o.graph[r],a=u["."];(o.next||(o.next={}))[r];let h=t._||{},l=h.DBG=t.DBG;if(l&&(l.g=+new Date),!n)return o.on("get",t);if(a){if(typeof a!="string"||ee===n[a])return o.on("get",t);n=Z({},a,ae(n,a),n[a],r)}n&&je(t,n),o.on("get",t)};function je(t,e){let o=+new Date,u=t._||{},r=u.DBG=t.DBG,n=t["#"],a=ie(9),h=Object.keys(e||"").sort(),l=((e||"")._||"")["#"];h.length;let f=t.$._.root,y=e===f.graph[l];console.STAT&&console.STAT(o,((r||u).gk=+new Date)-o,"got keys");function g(){o=+new Date;let w=0,v,p={},i;for(;w<9&&(v=h[w++]);)Z(p,v,ae(e,v),e[v],l);h=h.slice(w),(i={})[l]=p,p=i;let c;y&&(c=function(){},c.ram=c.faith=!0),i=h.length,console.STAT&&console.STAT(o,-(o-(o=+new Date)),"got copied some"),r&&(r.ga=+new Date),f.on("in",{"@":n,"#":a,put:p,"%":i?a=ie(9):ee,$:f.$,_:c,DBG:r}),console.STAT&&console.STAT(o,+new Date-o,"got in"),i&&setTimeout.turn(g)}e&&g()}$.on.get.ack=je;var ye=(t,e)=>{Object.keys(t).forEach(e,t)},ie=String.random,Qe=setTimeout.turn,et=$.valid,ae=$.state.is,Z=$.state.ify,ee,tt={};$.chain.opt=function(t){t=t||{};let e=this,o=e._,u=t.peers||t;return Object.plain(t)||(t={}),Object.plain(o.opt)||(o.opt=t),typeof u=="string"&&(u=[u]),Object.plain(o.opt.peers)||(o.opt.peers={}),u instanceof Array&&(t.peers={},u.forEach(function(r){let n={};n.id=n.url=r,t.peers[r]=o.opt.peers[r]=o.opt.peers[r]||n})),ye(t,function r(n){let a=this[n];if(this&&this.hasOwnProperty(n)||typeof a=="string"||Object.empty(a)){this[n]=a;return}a&&a.constructor!==Object&&!(a instanceof Array)||ye(a,r)}),o.opt.from=t,$.on("opt",o),o.opt.uuid=o.opt.uuid||function(r){return $.state().toString(36).replace(".","")+String.random(r||12)},e};$.log=function(){G.log.apply(G,arguments)};$.log.once=function(t,e,o){return(o=$.log.once)[t]=o[t]||0,o[t]++||$.log(e)};typeof window<"u"&&((window.GUN=window.Gun=$).window=window);($.window||{}).console=($.window||{}).console||{log:()=>{}};(G=console).only=function(t,e){return G.only.i&&t===G.only.i&&G.only.i++&&(G.log.apply(G,arguments)||e)};$.log.once("welcome","GDB > Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!");var nt=async()=>await Promise.resolve().then(()=>(Ie(),Se)).then(t=>t.default($));nt();var x=$;x.chain.chain=function(t){let e=this,o=e._,u=new(t||e).constructor(e),r=u._,n;return r.root=n=o.root,r.id=++n.once,r.back=e._,r.on=x.on,r.on("in",x.on.in,r),r.on("out",x.on.out,r),u};var rt={},C,ot=String.random,Q=x.valid,it=(t,e)=>t&&Object.prototype.hasOwnProperty.call(t,e),Ce=x.state,q=Ce.is,at=Ce.ify;function ut(t,e){let o=this.as,u=o.$._,r=o.get||"",n=(t.put||"")[r["#"]]||"";if(!t.put||typeof r["."]=="string"&&C===n[r["."]]){if(C!==u.put||!u.soul&&!u.has)return;u.ack=(u.ack||0)+1,u.on("in",{get:u.get,put:u.put=C,$:u.$,"@":t["@"]});return}(t._||{}).miss=1,x.on.put(t)}function ue(t,e){let o=t.put||"",u=C!==o["="]?o["="]:o[":"],r=e.root,n,a;if(C===u){if(e.soul&&C!==e.put||(a=(t.$$||t.$||"")._||"",t["@"]&&(C!==a.put||C!==e.put)))return;((n=e.link)||t.linked)&&delete(r.$.get(n)._.echo||"")[e.id],e.has&&(e.link=null),e.put=C,setTimeout.each(Object.keys(e.next||""),function(h,l){!(l=e.next[h])||(n&&delete(r.$.get(n).get(h)._.echo||"")[l.id],l.on("in",{get:h,put:C,$:l.$}))},0,99);return}e.soul||t.$$||(n=Q(u),a=t.$._||"",!((n===a.link||e.has&&!a.link)&&!((r.pass||"")[e.id]&&typeof n!="string"))&&(delete(a.echo||"")[e.id],ue({get:e.get,put:C,$:t.$,linked:t.linked=t.linked||a.link},e)))}function st(t){let e,o=this.as,u=o.back,r=o.root,n;if(t.$||(t.$=o.$),this.to.next(t),o.err){o.on("in",{put:o.put=C,$:o.$});return}if(e=t.get,e){if(r.pass&&(r.pass[o.id]=o),o.lex&&Object.keys(o.lex).forEach(function(a){n[a]=o.lex[a]},n=t.get=t.get||{}),e["#"]||o.soul){if(e["#"]=e["#"]||o.soul,t["#"]||(t["#"]=ot(9)),u=r.$.get(e["#"])._,e=e["."]){if(it(u.put,e)&&(n=u.ask&&u.ask[e],(u.ask||(u.ask={}))[e]=u.$.get(e)._,u.on("in",{get:e,put:{"#":u.soul,".":e,":":u.put[e],">":q(r.graph[u.soul],e)}}),n))return}else{if(n=u.ask&&u.ask[""],(u.ask||(u.ask={}))[""]=u,C!==u.put&&(u.on("in",u),n))return;t.$=u.$}return r.ask(ut,t),r.on("in",t)}if(e["."])return o.get?(t={get:{".":o.get},$:o.$},(u.ask||(u.ask={}))[o.get]=t.$._,u.on("out",t)):(t={get:o.lex?t.get:{},$:o.$},u.on("out",t));if((o.ask||(o.ask={}))[""]=o,o.get)return e["."]=o.get,(u.ask||(u.ask={}))[o.get]=t.$._,u.on("out",t)}return u.on("out",t)}function ft(t,e){e=e||this.as;let o=e.root,u=t.$||(t.$=e.$),r=(u||"")._||rt,n=t.put||"",a=n["#"],h=n["."],l=C!==n["="]?n["="]:n[":"],f=n[">"]||-1/0,y;if(C!==t.put&&(C===n["#"]||C===n["."]||C===n[":"]&&C===n["="]||C===n[">"])){if(!Q(n)){if(!(a=((n||"")._||"")["#"])){console.log("chain not yet supported for",n,"...",t,e);return}return u=e.root.$.get(a),setTimeout.each(Object.keys(n).sort(),function(g){g==="_"||C===(f=q(n,g))||e.on("in",{$:u,put:{"#":a,".":g,"=":n[g],">":f},VIA:t})})}e.on("in",{$:r.back.$,put:{"#":a=r.back.soul,".":h=r.has||r.get,"=":n,">":q(r.back.put,h)},via:t});return}(t.seen||"")[e.id]||((t.seen||(t.seen=function(){}))[e.id]=e,e!==r&&(Object.keys(t).forEach(function(g){n[g]=t[g]},n={}),n.get=e.get||n.get,!e.soul&&!e.has?n.$$$=n.$$$||e.$:r.soul&&(n.$=e.$,n.$$=n.$$||r.$),t=n),ue(t,e),(e.soul||t.$$)&&f>=q(o.graph[a],h)&&((n=o.$.get(a)._).put=at(n.put,h,f,l,a)),!r.soul&&f>=q(o.graph[a],h)&&(y=(o.$.get(a)._.next||"")[h])&&(y.put=l,typeof(n=Q(l))=="string"&&(y.put=o.$.get(n)._.put||l)),this.to&&this.to.next(t),e.any&&setTimeout.each(Object.keys(e.any),function(g){(g=e.any[g])&&g(t)},0,99),e.echo&&setTimeout.each(Object.keys(e.echo),function(g){(g=e.echo[g])&&g.on("in",t)},0,99),((t.$$||"")._||r).soul&&(y=e.next)&&(y=y[h])&&(n={},Object.keys(t).forEach(function(g){n[g]=t[g]}),n.$=(t.$$||t.$).get(n.get=h),delete n.$$,delete n.$$$,y.on("in",n)),Be(t,e))}function Be(t,e){if(e=e||this.as||t.$._,t.$$&&this!==x.on||!t.put||e.soul)return;let o=t.put||"",u=o["="]||o[":"];var h;let r=e.root,n=r.$.get(o["#"]).get(o["."])._;if(typeof(u=Q(u))!="string"){this===x.on&&((n.echo||(n.echo={}))[e.id]=e);return}if((n.echo||(n.echo={}))[e.id]&&!(r.pass||"")[e.id])return;if(h=r.pass){if(h[u+e.id])return;h[u+e.id]=1}(n.echo||(n.echo={}))[e.id]=e,e.has&&(e.link=u);let a=r.$.get(n.link=u)._;(a.echo||(a.echo={}))[n.id]=n;var h=e.ask||"";(h[""]||e.lex)&&a.on("out",{get:{"#":u}}),setTimeout.each(Object.keys(h),function(l,f){!l||!(f=h[l])||f.on("out",{get:{"#":u,".":l}})},0,99)}x.on.out=st;x.on.in=ft;x.on.link=Be;x.on.unlink=ue;var ct={},de;x.chain.back=function(t,e){let o;if(t=t||1,t===-1||t===1/0)return this._.root.$;if(t===1)return(this._.back||this._).$;let u=this,r=u._;if(typeof t=="string"&&(t=t.split(".")),t instanceof Array){let n=0,a=t.length;for(o=r,n;n<a;n++)o=(o||ct)[t[n]];return de!==o?e?u:o:(o=r.back)?o.$.back(t,e):void 0}if(typeof t=="function"){let n,a={back:r};for(;(a=a.back)&&de===(n=t(a,e)););return n}return typeof t=="number"?(r.back||r).$.back(t-1):this};x.chain.put=function(t,e,o){let u=this,r=u._,n=r.root;o=o||{},o.root=r.root,o.run||(o.run=n.once),ne(o,r.id),o.ack=o.ack||e,o.via=o.via||u,o.data=o.data||t,o.soul||(o.soul=r.soul||typeof e=="string"&&e);let a=o.state=o.state||x.state();if(typeof t=="function")return t(l=>{o.data=l,u.put(we,we,o)}),u;if(!o.soul)return lt(o),u;o.$=n.$.get(o.soul),o.todo=[{it:o.data,ref:o.$}],o.turn=o.turn||ht,o.ran=o.ran||I;function h(){let l=o.todo,f=l.pop(),y=f.it;f.ref&&f.ref._.id;let g,w,v,p,i;if(ne(o,f.ref),(p=f.todo)&&(w=p.pop(),y=y[w],p.length&&l.push(f)),w&&(l.path||(l.path=[])).push(w),!(g=gt(y))&&!(i=x.is(y))){if(!Object.plain(y)){I.err(o,`Invalid data: ${pt(y)} at ${o.via.back(s=>{s.get&&p.push(s.get)},p=[])||p.join(".")}.${(l.path||[]).join(".")}`);return}let c=o.seen||(o.seen=[]),d=c.length;for(;d--;)if(y===(p=c[d]).it){g=y=p.link;break}}if(w&&g)f.node=me(f.node,w,a,y);else{let c=function(s,m){let k=v.link["#"];m&&(m.off(),m.rid(s));let b=k||s.soul||(p=(s.$$||s.$)._||"").soul||p.link||((p=p.put||"")._||"")["#"]||p["#"]||((p=s.put||"")&&s.$$?p["#"]:(p["="]||p[":"]||"")["#"]);if(!k&&ne(o,s.$),!b&&!f.link["#"]){(f.wait||(f.wait=[])).push(function(){c(s,m)});return}b||(b=[],(s.$$||s.$).back(function(S){if(p=S.soul||S.link)return b.push(p);b.push(S.get)}),b=b.reverse().join("/")),v.link["#"]=b,!i&&(((o.graph||(o.graph={}))[b]=v.node||(v.node={_:{}}))._["#"]=b),delete o.wait[d],v.wait&&setTimeout.each(v.wait,function(S){S&&S()}),o.ran(o)};if(!o.seen){I.err(o,"Data at root of graph must be a node (an object).");return}o.seen.push(v={it:y,link:{},todo:i?[]:Object.keys(y).sort().reverse(),path:(l.path||[]).slice(),up:f}),f.node=me(f.node,w,a,v.link),!i&&v.todo.length&&l.push(v);let d=o.seen.length;(o.wait||(o.wait={}))[d]="",p=(v.ref=i?y:w?f.ref.get(w):f.ref)._,(p=y&&(y._||"")["#"]||p.soul||p.link)?c({soul:p}):v.ref.get(c,{run:o.run,v2020:1,out:{get:{".":" "}}})}if(!l.length)return o.ran(o);o.turn(h)}return h(),u};function ne(t,e){if(!e)return;e=(e._||"").id||e;let o=t.root.stun||(t.root.stun={on:x.on}),u={},r;t.stun||(t.stun=o.on("stun",()=>{})),(r=o.on(`${e}`))&&r.the.last.next(u),!(u.run>=t.run)&&o.on(`${e}`,function(n){if(t.stun.end){this.off(),this.to.next(n);return}n.run=n.run||t.run,n.stun=n.stun||t.stun})}function I(t){if(t.err){I.end(t.stun,t.root);return}if(t.todo.length||t.end||!Object.empty(t.wait))return;t.end=1;let e=t.$.back(-1)._,o=e.root,u=e.ask(function(h){o.on("ack",h),h.err&&x.log(h),++r>(t.acks||0)&&this.off(),t.ack&&t.ack(h,this)},t.opt),r=0,n=t.stun,a;(a=function(){!n||(I.end(n,o),setTimeout.each(Object.keys(n=n.add||""),function(h){(h=n[h])&&h()}))}).hatch=a,t.via._.on("out",{put:t.out=t.graph,ok:t.ok||t.opt,opt:t.opt,"#":u,_:a})}I.end=function(t,e){t.end=Ne,t.the.to===t&&t===t.the.last&&delete e.stun,t.off()};I.err=function(t,e){(t.ack||Ne).call(t,t.out={err:t.err=x.log(e)}),t.ran(t)};function lt(t){let e=t.via._,o;t.via=t.via.back(function(u){if(u.soul||!u.get)return u.$;o=t.data,(t.data={})[u.get]=o}),(!t.via||!t.via._.soul)&&(t.via=e.root.$.get(((t.data||"")._||"")["#"]||e.$.back("opt.uuid")())),t.via.put(t.data,t.ack,t)}function pt(t,e){return t&&(e=t.constructor)&&e.name||typeof t}var we,Ne=()=>{},ht=setTimeout.turn,gt=x.valid,me=x.state.ify,yt={},dt=x.valid,U;function wt(t,e){let o=e._,u=o.next,r=e.chain()._;return u||(u=o.next={}),u[r.get=t]=r,e===o.root.$?r.soul=t:(o.soul||o.has)&&(r.has=t),r}function mt(t,e,o,u){let r=t._,n=0,a;return(a=r.soul||r.link)?e(a,u,r):r.jam?r.jam.push([e,u]):(r.jam=[[e,u]],t.get(function(h,l){if(U===h.put&&!r.root.opt.super&&(a=Object.keys(r.root.opt.peers).length)&&++n<=a)return;l.rid(h);let f=(f=h.$)&&f._||{},y=0,g;for(a=r.jam,delete r.jam;g=a[y++];){let w=g[0];g=g[1],w&&w(f.link||f.soul||x.valid(h.put)||((h.put||{})._||{})["#"],g,h,l)}},{out:{get:{".":!0}}}),t)}function bt(t){let e=this.at||this.on;if(!t||e.soul||e.has)return this.off();if(!(t=(t=(t=t.$||t)._||t).id))return;e.map;let o;if((o=this.seen||(this.seen={}))[t])return!0;o[t]=!0}x.chain.get=function(t,e,o){let u,r;if(typeof t=="string"){if(t.length===0)return(u=this.chain())._.err={err:x.log("0 length key!",t)},e&&e.call(u,u._.err),u;let n=this;(u=(n._.next||yt)[t])||(u=t&&wt(t,n)),u=u&&u.$}else if(typeof t=="function"){let n=function(g,w,v){if(n.stun)return;let p=g.$._,i=(g.$$||"")._,c=(i||p).put,d=!p.has&&!p.soul,s={},m;if((d||U===c)&&(c=U===((m=g.put)||"")["="]?U===(m||"")[":"]?m:m[":"]:m["="]),typeof(m=x.valid(c))=="string"&&(c=U===(m=l.$.get(m)._.put)?h.not?U:c:m),!(h.not&&U===c)){if(U===h.stun){if((m=l.stun)&&m.on&&(a.$.back(function(k){if(m.on(`${k.id}`,s={}),(s.run||0)<n.id)return s}),!s.run&&m.on(`${p.id}`,s={}),!s.run&&i&&m.on(`${i.id}`,s={}),n.id>s.run&&((!s.stun||s.stun.end)&&(s.stun=m.on("stun"),s.stun=s.stun&&s.stun.last),s.stun&&!s.stun.end))){(s.stun.add||(s.stun.add={}))[f]=function(){n(g,w,1)};return}if(U===c&&(v=0),(m=l.hatch)&&!m.end&&U===h.hatch&&!v){if(y[p.$._.id])return;y[p.$._.id]=1,m.push(function(){n(g,w,1)});return}y={}}if(l.pass){if(l.pass[f+p.id])return;l.pass[f+p.id]=1}if(h.on){h.ok.call(p.$,c,p.get,g,w||n);return}if(h.v2020){h.ok(g,w||n);return}Object.keys(g).forEach(function(k){m[k]=g[k]},m={}),g=m,g.put=c,h.ok.call(h.as,g,w||n)}};if(e===!0)return mt(this,t,e,o);u=this;let a=u._,h=e||{},l=a.root,f;h.at=a,h.ok=t;let y={};return n.at=a,(a.any||(a.any={}))[f=String.random(7)]=n,n.off=function(){n.stun=1,a.any&&delete a.any[f]},n.rid=bt,n.id=h.run||++l.once,r=l.pass,(l.pass={})[f]=1,h.out=h.out||{get:{}},a.on("out",h.out),l.pass=r,u}else{if(typeof t=="number")return this.get(`${t}`,e,o);if(typeof(r=dt(t))=="string")return this.get(r,e,o);(r=this.get.next)&&(u=r(this,t))}return u?(e&&typeof e=="function"&&u.get(e,o),u):((u=this.chain())._.err={err:x.log("Invalid get request!",t)},e&&e.call(u,u._.err),u)};x.chain.on=function(t,e,o,u){let r=this,n=r._,a;if(typeof t=="string")return e?(a=n.on(t,e,o||n,u),o&&o.$&&(o.subs||(o.subs=[])).push(a),r):n.on(t);let h=e;return(h=h===!0?{change:!0}:h||{}).not=1,h.on=1,r.get(t,h),r};x.chain.once=function(t,e){e=e||{};let o=this,u=o._,r=u.root,n=String.random(7),a,h;return o.get(function(l,f,y,g){let w=this,v=w._,p=v.one||(v.one={});function i(c){if(!v.has&&!v.soul&&(v={put:l,get:f}),h===(a=v.put)&&(a=((y.$$||"")._||"").put),typeof x.valid(a)=="string"&&(a=r.$.get(a)._.put,a===h&&!c)){p[n]=setTimeout(function(){i(1)},e.wait||99);return}g.stun||p[n]!==""&&(p[n]="",(u.soul||u.has)&&g.off(),t.call(w,a,v.get),clearTimeout(p[n]))}if(!g.stun&&p[n]!==""){if((a=x.valid(l))===!0){i();return}typeof a!="string"&&(clearTimeout((u.one||"")[n]),clearTimeout(p[n]),p[n]=setTimeout(i,e.wait||99))}},{on:1}),o};x.chain.off=function(){let t=this,e=t._,o,u=e.back;if(u)return e.ack=0,(o=u.next)&&o[e.get]&&delete o[e.get],o===u.any&&(delete u.any,u.any={}),o===u.ask&&delete o[e.get],o===u.put&&delete o[e.get],o===e.soul&&delete u.root.graph[o],o===e.map&&Object.keys(o).forEach(function(r,n){n=o[r],n.link&&u.root.$.get(n.link).off()}),o===e.next&&Object.keys(o).forEach(function(r,n){n=o[r],n.$.off()}),e.on("off",{}),t};var vt=x.chain.get.next,Ge=()=>{},be;function kt(t){this.to.next(t);let e=this.as,o=t.$._,u=t.put,r;!o.soul&&!t.$$||(r=e.lex)&&!String.match(t.get||(u||"")["."],r["."]||r["#"]||r)||x.on.link(t,e)}x.chain.get.next=function(t,e){let o;return Object.plain(e)?(o=(o=e["#"])||"")["="]||o?t.get(o):((o=t.chain()._).lex=e,t.on("in",function(u){String.match(u.get||(u.put||"")["."],e["."]||e["#"]||e)&&o.on("in",u),this.to.next(u)}),o.$):(vt||Ge)(t,e)};x.chain.map=function(t,e,o){let u=this,r=u._,n,a;return Object.plain(t)&&(n=t["."]?t:{".":t},t=be),t?(x.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),a=u.chain(),u.map().on(function(h,l,f,y){let g=(t||Ge).call(this,h,l,f,y);if(be===g)return;if(h===g)return a._.on("in",f);if(x.is(g))return a._.on("in",g._);let w={};Object.keys(f.put).forEach(v=>{w[v]=f.put[v]},w),w["="]=g,a._.on("in",{get:l,put:w})}),a):((a=r.each)||((r.each=a=u.chain())._.lex=n||a._.lex||r.lex,a._.nix=u.back("nix"),u.on("in",kt,a._)),a)};x.chain.set=function(t,e,o){let u=this,r=u.back(-1),n,a;return e=e||function(){},o=o||{},o.item=o.item||t,(n=(t||"")._||"")["#"]&&((t={})["#"]=n),typeof(a=x.valid(t))=="string"&&u.get(n=a).put(t,e,o),x.is(t)?(u.put(h=>{t.get((l,f,y)=>{if(!l)return e.call(u,{err:x.log(`Only a node can be linked! Not "${y.put}"!`)});(a={})[l]={"#":l},h(a)},!0)}),t):(Object.plain(t)&&(t=r.get(n=u.back("opt.uuid")()).put(t)),u.get(n||r.back("opt.uuid")(7)).put(t,e,o))};var St=()=>{},J=JSON.stringifyAsync||function(t,e,o,u){let r,n=+new Date;try{e(r,JSON.stringify(t,o,u),J.sucks(+new Date-n))}catch(a){e(a)}},ve=JSON.parseAsync||function(t,e,o){let u,r=+new Date;try{e(u,JSON.parse(t,o),J.sucks(+new Date-r))}catch(n){e(n)}};J.sucks=t=>{t>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),J.sucks=St)};function At(t){let e=()=>{},o=t.opt||{};o.log=o.log||console.log,o.gap=o.gap||o.wait||0,o.max=o.max||(o.memory?o.memory*999*999:3e8)*.3,o.pack=o.pack||o.max*.01*.01,o.puff=o.puff||9;let u=setTimeout.turn||setTimeout,r=t.dup,n=r.check,a=r.track,h=e.hear=function(i,c){if(!i)return;if(o.max<=i.length)return e.say({dam:"!",err:"Message too big!"},c);e===this&&(h.d+=i.length||0,++h.c);let d=c.SH=+new Date,s=i[0],m;if(s==="["){ve(i,function(k,b){if(k||!b)return e.say({dam:"!",err:"DAM JSON parse error."},c);console.STAT&&console.STAT(+new Date,b.length,"# on hear batch");let S=o.puff;function A(){let _=+new Date,T=0,O;for(;T<S&&(O=b[T++]);)e.hear(O,c);b=b.slice(T),console.STAT&&console.STAT(_,+new Date-_,"hear loop"),w(c),b.length&&u(A,0)}A()}),i="";return}if(s==="{"||(i["#"]||Object.plain(i))&&(m=i)){if(m)return h.one(m,c,d);ve(i,function(k,b){if(k||!b)return e.say({dam:"!",err:"DAM JSON parse error."},c);h.one(b,c,d)})}};h.one=function(i,c,d){let s,m,k,b,S;if(i.DBG&&(i.DBG=S={DBG:i.DBG}),S&&(S.h=d),S&&(S.hp=+new Date),(s=i["#"])||(s=i["#"]=String.random(9)),!(k=n(s))&&(m=i["##"],!(m&&(k=i["@"]||i.get&&s)&&r.check(b=k+m)))){if((i._=function(){}).via=e.leap=c,(k=i["><"])&&typeof k=="string"&&k.slice(0,99).split(",").forEach(function(A){this[A]=1},i._.yo={}),k=i.dam){(k=e.hear[k])&&k(i,c,t),a(s);return}d=+new Date,S&&(S.is=d),c.SI=s,t.on("in",e.last=i),S&&(S.hd=+new Date),console.STAT&&console.STAT(d,+new Date-d,i.get?"msg get":i.put?"msg put":"msg"),(k=a(s)).via=c,i.get&&(k.it=i),b&&a(b),e.leap=e.last=null}},h.c=h.d=0;let l=0,f;function y(i){this.to[i]=this.on[i]}function g(i,c){let d;return c instanceof Object?(Object.keys(c).sort().forEach(y,{to:d={},on:c}),d):c}e.hash=function(i,c){let d,s,m,k=+new Date;function b(S,A){let _=(s||(s=m=A||"")).slice(0,32768);if(d=String.hash(_,d),s=s.slice(32768),s){u(b,0);return}console.STAT&&console.STAT(k,+new Date-k,"say json+hash"),i._.$put=m,i["##"]=d,e.say(i,c),delete i._.$put}J(i.put,b,g)},e.say=function(i,c){let d;if((d=this)&&(d=d.to)&&d.next&&d.next(i),!i)return!1;let s,m,k=i["@"],b=i._||(i._=function(){}),S=i.DBG,A=+new Date;if(b.y=b.y||A,c||S&&(S.y=A),(s=i["#"])||(s=i["#"]=String.random(9)),!f&&a(s),i.put&&(i.err||(r.s[s]||"").err))return!1;if(!i["##"]&&ke!==i.put&&!b.via&&k){e.hash(i,c);return}if(!c&&k&&(c=(d=r.s[k])&&(d.via||(d=d.it)&&(d=d._)&&d.via)||(d=e.last)&&k===d["#"]&&e.leap),!c&&k)return r.s[k]?void 0:(console.STAT&&console.STAT(+new Date,++l,"total no peer to ack to"),!1);if(!c&&e.way)return e.way(i);if(S&&(S.yh=+new Date),!(m=b.raw)){e.raw(i,c);return}if(S&&(S.yr=+new Date),!c||!c.id){let T=function(){let D=+new Date;f=1;let N=b.raw;b.raw=m;let B=0,H;for(;B<9&&(H=(E||"")[B++]);)!(H=j[H])||e.say(i,H);b.raw=N,f=0,E=E.slice(B),console.STAT&&console.STAT(D,+new Date-D,"say loop"),E.length&&(u(T,0),k&&a(k))};if(!Object.plain(c||o.peers))return!1;let O=+new Date;o.puff;let j=o.peers,E=Object.keys(c||o.peers||{});console.STAT&&console.STAT(O,+new Date-O,"peer keys"),T();return}if(!c.wire&&e.wire&&e.wire(c),s===c.last)return;if(c.last=s,c===b.via||(d=b.yo)&&(d[c.url]||d[c.pid]||d[c.id]))return!1;if(console.STAT&&console.STAT(A,((S||b).yp=+new Date)-(b.y||A),"say prep"),!f&&k&&a(k),c.batch){if(c.tail=(d=c.tail||0)+m.length,c.tail<=o.pack){c.batch+=(d?",":"")+m;return}w(c)}c.batch="[";let _=+new Date;setTimeout(function(){console.STAT&&console.STAT(_,+new Date-_,"0ms TO"),w(c)},o.gap),v(m,c),console.STAT&&k===c.SI&&console.STAT(A,+new Date-c.SH,"say ack")},e.say.c=e.say.d=0,e.raw=function(i,c){if(!i)return"";let d=i._||{},s,m;if(m=d.raw)return m;if(typeof i=="string")return i;let k=i["##"],b=i["@"];if(k&&b){if(!d.via&&n(b+k))return!1;if((m=(r.s[b]||"").it)||(m=e.last)&&b===m["#"]){if(k===m["##"])return!1;m["##"]||(m["##"]=k)}}if(!i.dam){let A=0,_=[];m=o.peers;for(let T in m){let O=m[T];if(_.push(O.url||O.pid||O.id),++A>6)break}A>1&&(i["><"]=_.join())}if(s=d.$put){m={},Object.keys(i).forEach(function(A){m[A]=i[A]}),m.put=":])([:",J(m,function(A,_){if(A)return;let T=+new Date;m=_.indexOf('"put":":])([:"'),S(ke,_=_.slice(0,m+6)+s+_.slice(m+14)),console.STAT&&console.STAT(T,+new Date-T,"say slice")});return}J(i,S);function S(A,_){A||(d.raw=_,e.say(i,c))}};function w(i){let c=i.batch,d=typeof c=="string";if(d&&(c+="]"),i.batch=i.tail=null,!!c&&!(d?c.length<3:!c.length)){if(!d)try{c=c.length===1?c[0]:JSON.stringify(c)}catch(s){return o.log("DAM JSON stringify error",s)}!c||v(c,i)}}function v(i,c){try{let d=c.wire;c.say?c.say(i):d.send&&d.send(i),e.say.d+=i.length||0,++e.say.c}catch{(c.queue=c.queue||[]).push(i)}}e.hi=function(i){let c=i.wire,d;if(!c){e.wire(i.length&&{url:i,id:i}||i);return}i.id?o.peers[i.url||i.id]=i:(d=i.id=i.id||String.random(9),e.say({dam:"?",pid:t.opt.pid},o.peers[d]=i),delete r.s[i.last]),i.met=i.met||+new Date,c.hied||t.on(c.hied="hi",i),d=i.queue,i.queue=[],setTimeout.each(d||[],function(s){v(s,i)},0,9)},e.bye=function(i){t.on("bye",i);let c=+new Date;c=c-(i.met||c),e.bye.time=((e.bye.time||c)+c)/2},e.hear["!"]=function(i,c){o.log("Error:",i.err)},e.hear["?"]=function(i,c){i.pid&&(c.pid||(c.pid=i.pid),i["@"])||(e.say({dam:"?",pid:o.pid,"@":i["#"]},c),delete r.s[c.last])},t.on("create",function(i){i.opt.pid=i.opt.pid||String.random(9),this.to.next(i),i.on("out",e.say)}),t.on("bye",function(i,c){i=o.peers[i.id||i]||i,this.to.next(i),i.bye?i.bye():(c=i.wire)&&c.close&&c.close(),delete o.peers[i.id],i.wire=null});let p={};return t.on("bye",function(i,c){this.to.next(i),(c=console.STAT)&&(c.peers=(c.peers||0)-1),(c=i.url)&&(p[c]=!0,setTimeout(function(){delete p[c]},o.lack||9e3))}),t.on("hi",function(i,c){this.to.next(i),(c=console.STAT)&&(c.peers=(c.peers||0)+1),!(!(c=i.url)||!p[c])&&(delete p[c],setTimeout.each(Object.keys(t.next),function(d){t.next[d],c={},c[d]=t.graph[d],c=String.hash(c),e.say({"##":c,get:{"#":d}},i)}))}),e}var ke,_t=At;x.Mesh=_t;console.log("+websocket");x.on("opt",function(t){this.to.next(t);let e=t.opt,o=x.window||{},u=e.WebSocket||o.WebSocket||o.webkitWebSocket||o.mozWebSocket;if(!u)return;e.WebSocket=u;let r=e.mesh=e.mesh||x.Mesh(t);function n(a){if(!a.url)return;let h=a.url.replace(/^http/,"ws")||null,l=a.wire=new e.WebSocket(h);return e.mesh.hi(a),l.onclose=f=>{e.mesh.bye(a),setTimeout(()=>n(a),500)},l.onopen=()=>{console.log(`open > ${a.url}`),e.mesh.hi(a),console.log(a)},l.onmessage=function(f){!f||e.mesh.hear(f.data||f,a)},l}r.wire=e.wire=n,e.wire=n,!e.super&&t.on("out",{dam:"hi"})});console.log("+webrtc");x.on("opt",function(t){this.to.next(t);let e=t.opt;x.opt=e;let o;typeof window<"u"&&(o=window),typeof global<"u"&&(o=global),o=o||{};let u=e.RTCPeerConnection||o.RTCPeerConnection||o.webkitRTCPeerConnection||o.mozRTCPeerConnection,r=e.RTCSessionDescription||o.RTCSessionDescription||o.webkitRTCSessionDescription||o.mozRTCSessionDescription,n=e.RTCIceCandidate||o.RTCIceCandidate||o.webkitRTCIceCandidate||o.mozRTCIceCandidate;e.RTCPeerConnection=u,e.RTCSessionDescription=r,e.RTCIceCandidate=n,e.rtc=e.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},e.rtc.dataChannel=e.rtc.dataChannel||{ordered:!1,maxRetransmits:2},e.rtc.sdp=e.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},e.rtc.max=e.rtc.max||55,e.rtc.room=(e.rtc.room||x.window)&&(location.hash.slice(1)||location.pathname.slice(1)),e.announce=l=>{e.rtc.start=+new Date,t.$.get(`/RTC/${e.rtc.room}<?99`).get("+").put(e.pid,f=>{h(f)},{acks:e.rtc.max}).on((f,y,g)=>{f===e.pid||e.rtc.start>g.put[">"]||h({"#":`${g["#"]}`,ok:{rtc:{id:f}}})})};let a=e.mesh=e.mesh||x.Mesh(t);t.on("create",function(l){this.to.next(l),setTimeout(e.announce,1)});function h(l){if(this&&this.off&&this.off(),!l.ok)return;let f=l.ok.rtc,y,g;if(!f||!f.id||f.id===e.pid)return;if(g=f.answer){if(!(y=e.peers[f.id]||h[f.id])||y.remoteSet)return;g.sdp=g.sdp.replace(/\\r\\n/g,`\r
`),y.setRemoteDescription(y.remoteSet=new e.RTCSessionDescription(g))}(g=f.candidate)&&(y=e.peers[f.id]||h[f.id]||h({ok:{rtc:{id:f.id}}}),y.addIceCandidate(new e.RTCIceCandidate(g))),(y=new e.RTCPeerConnection(e.rtc)).id=f.id;let w=y.wire=y.createDataChannel("dc",e.rtc.dataChannel);if(h[f.id]=y,w.to=setTimeout(()=>{delete h[f.id]},1e3*60),w.onclose=()=>a.bye(y),w.onerror=v=>console.log(v),w.onopen=v=>{delete h[f.id],a.hi(y)},w.onmessage=v=>{console.log("via rtc"),a.hear(v.data||v,y)},y.onicecandidate=v=>{!v.candidate||t.on("out",{"@":l["#"],ok:{rtc:{candidate:v.candidate,id:e.pid}}})},y.ondatachannel=v=>{let p=v.channel;p.onmessage=w.onmessage,p.onopen=w.onopen,p.onclose=w.onclose},g=f.offer){f.offer.sdp=f.offer.sdp.replace(/\\r\\n/g,`\r
`),y.setRemoteDescription(new e.RTCSessionDescription(g)),y.createAnswer(v=>{y.setLocalDescription(v),t.on("out",{"@":l["#"],ok:{rtc:{answer:v,id:e.pid}}})},()=>{},e.rtc.sdp);return}return y.createOffer(v=>{y.setLocalDescription(v),t.on("out",{"@":l["#"],"#":t.ask(h),ok:{rtc:{offer:v,id:e.pid}}})},()=>{},e.rtc.sdp),y}});var xt=x,re=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function $t(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var se={exports:{}};se.exports;(function(t){(function(){function e(u,r){return r?$t(u):u.slice?e[n(u)]:function(a,h){u(a={exports:{}}),e[n(h)]=a.exports};function n(a){return a.split("/").slice(-1).toString().replace(".js","")}}var o=t;e(function(u){typeof self<"u"&&(u.window=self),typeof window<"u"&&(u.window=window);var r=u.window||u,n,a=r.SEA||{};(a.window=u.window)&&(a.window.SEA=a);try{n+""!=typeof o&&(o.exports=a)}catch{}u.exports=a})(e,"./root"),e(function(u){var r=e("./root");try{r.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(e,"./https"),e(function(u){var r;if(r+""==typeof btoa){if(r+""==typeof Buffer)try{re.Buffer=e("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}re.btoa=function(n){return Buffer.from(n,"binary").toString("base64")},re.atob=function(n){return Buffer.from(n,"base64").toString("binary")}}})(e,"./base64"),e(function(u){e("./base64");function r(){}Object.assign(r,{from:Array.from}),r.prototype=Object.create(Array.prototype),r.prototype.toString=function(n,a,h){n=n||"utf8",a=a||0;const l=this.length;if(n==="hex"){const f=new Uint8Array(this);return[...Array((h&&h+1||l)-a).keys()].map(y=>f[y+a].toString(16).padStart(2,"0")).join("")}if(n==="utf8")return Array.from({length:(h||l)-a},(f,y)=>String.fromCharCode(this[y+a])).join("");if(n==="base64")return btoa(this)},u.exports=r})(e,"./array"),e(function(u){e("./base64");var r=e("./array");function n(...a){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),n.from(...a)}n.prototype=Object.create(Array.prototype),Object.assign(n,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const a=arguments[0];let h;if(typeof a=="string"){const f=arguments[1]||"utf8";if(f==="hex"){const y=a.match(/([\da-fA-F]{2})/g).map(g=>parseInt(g,16));if(!y||!y.length)throw new TypeError("Invalid first argument for type 'hex'.");h=r.from(y)}else if(f==="utf8"||f==="binary"){const y=a.length,g=new Uint16Array(y);Array.from({length:y},(w,v)=>g[v]=a.charCodeAt(v)),h=r.from(g)}else if(f==="base64"){const y=atob(a),g=y.length,w=new Uint8Array(g);Array.from({length:g},(v,p)=>w[p]=y.charCodeAt(p)),h=r.from(w)}else f==="binary"?h=r.from(a):console.info("SafeBuffer.from unknown encoding: "+f);return h}if(a.byteLength,a.byteLength?a.byteLength:a.length){let f;return a instanceof ArrayBuffer&&(f=new Uint8Array(a)),r.from(f||a)}},alloc(a,h=0){return r.from(new Uint8Array(Array.from({length:a},()=>h)))},allocUnsafe(a){return r.from(new Uint8Array(Array.from({length:a})))},concat(a){if(!Array.isArray(a))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return r.from(a.reduce((h,l)=>h.concat(Array.from(l)),[]))}}),n.prototype.from=n.from,n.prototype.toString=r.prototype.toString,u.exports=n})(e,"./buffer"),e(function(u){const r=e("./root"),n={Buffer:e("./buffer")};var a={},h;if(JSON.parseAsync=JSON.parseAsync||function(f,y,g){var w;try{y(w,JSON.parse(f,g))}catch(v){y(v)}},JSON.stringifyAsync=JSON.stringifyAsync||function(f,y,g,w){var v;try{y(v,JSON.stringify(f,g,w))}catch(p){y(p)}},n.parse=function(f,y){return new Promise(function(g,w){JSON.parseAsync(f,function(v,p){v?w(v):g(p)},y)})},n.stringify=function(f,y,g){return new Promise(function(w,v){JSON.stringifyAsync(f,function(p,i){p?v(p):w(i)},y,g)})},r.window&&(n.crypto=r.window.crypto||r.window.msCrypto,n.subtle=(n.crypto||a).subtle||(n.crypto||a).webkitSubtle,n.TextEncoder=r.window.TextEncoder,n.TextDecoder=r.window.TextDecoder,n.random=f=>n.Buffer.from(n.crypto.getRandomValues(new Uint8Array(n.Buffer.alloc(f))))),!n.TextDecoder){const{TextEncoder:f,TextDecoder:y}=e((h+""==typeof o?".":"")+"./lib/text-encoding",1);n.TextDecoder=y,n.TextEncoder=f}if(!n.crypto)try{var l=e("crypto",1);Object.assign(n,{crypto:l,random:y=>n.Buffer.from(l.randomBytes(y))});const{Crypto:f}=e("@peculiar/webcrypto",1);n.ossl=n.subtle=new f({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}u.exports=n})(e,"./shim"),e(function(u){var r=e("./root"),n=e("./shim"),a={};a.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},a.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},a.ecdh={name:"ECDH",namedCurve:"P-256"},a.jwk=function(h,l){h=h.split(".");var f=h[0],y=h[1],g={kty:"EC",crv:"P-256",x:f,y,ext:!0};return g.key_ops=l?["sign"]:["verify"],l&&(g.d=l),g},a.keyToJwk=function(h){return{kty:"oct",k:h.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},a.recall={validity:12*60*60,hook:function(h){return h}},a.check=function(h){return typeof h=="string"&&h.slice(0,4)==="SEA{"},a.parse=async function(l){try{var f=typeof l=="string";return f&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),f?await n.parse(l):l}catch{}return l},r.opt=a,u.exports=a})(e,"./settings"),e(function(u){var r=e("./shim");u.exports=async function(n,a){var h=typeof n=="string"?n:await r.stringify(n),l=await r.subtle.digest({name:a||"SHA-256"},new r.TextEncoder().encode(h));return r.Buffer.from(l)}})(e,"./sha256"),e(function(u){const r=e("./shim"),n=r.subtle,a=r.ossl?r.ossl:n,h=l=>a.digest({name:"SHA-1"},new ArrayBuffer(l));u.exports=h})(e,"./sha1"),e(function(u){var r=e("./root"),n=e("./shim"),a=e("./settings"),h=e("./sha256"),l;r.work=r.work||(async(f,y,g,w)=>{try{var v=(y||{}).epub||y;if(w=w||{},v instanceof Function&&(g=v,v=l),f=typeof f=="string"?f:await n.stringify(f),(w.name||"").toLowerCase().slice(0,3)==="sha"){var p=n.Buffer.from(await h(f,w.name),"binary").toString(w.encode||"base64");if(g)try{g(p)}catch(s){console.log(s)}return p}v=v||n.random(9);var i=await(n.ossl||n.subtle).importKey("raw",new n.TextEncoder().encode(f),{name:w.name||"PBKDF2"},!1,["deriveBits"]),c=await(n.ossl||n.subtle).deriveBits({name:w.name||"PBKDF2",iterations:w.iterations||a.pbkdf2.iter,salt:new n.TextEncoder().encode(w.salt||v),hash:w.hash||a.pbkdf2.hash},i,w.length||a.pbkdf2.ks*8);f=n.random(f.length);var d=n.Buffer.from(c,"binary").toString(w.encode||"base64");if(g)try{g(d)}catch(s){console.log(s)}return d}catch(s){if(console.log(s),r.err=s,r.throw)throw s;g&&g();return}}),u.exports=r.work})(e,"./work"),e(function(u){var r=e("./root"),n=e("./shim");e("./settings"),r.name=r.name||(async(a,h)=>{try{if(a)try{a()}catch(l){console.log(l)}return}catch(l){if(console.log(l),r.err=l,r.throw)throw l;a&&a();return}}),r.pair=r.pair||(async(a,h)=>{try{var l=n.ossl||n.subtle,f=await n.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async w=>{var v={};v.priv=(await n.subtle.exportKey("jwk",w.privateKey)).d;var p=await n.subtle.exportKey("jwk",w.publicKey);return v.pub=p.x+"."+p.y,v});try{var y=await l.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async w=>{var v={};v.epriv=(await l.exportKey("jwk",w.privateKey)).d;var p=await l.exportKey("jwk",w.publicKey);return v.epub=p.x+"."+p.y,v})}catch(w){if(r.window)throw w;if(w=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw w}y=y||{};var g={pub:f.pub,priv:f.priv,epub:y.epub,epriv:y.epriv};if(a)try{a(g)}catch(w){console.log(w)}return g}catch(w){if(console.log(w),r.err=w,r.throw)throw w;a&&a();return}}),u.exports=r.pair})(e,"./pair"),e(function(u){var r=e("./root"),n=e("./shim"),a=e("./settings"),h=e("./sha256"),l;r.sign=r.sign||(async(f,y,g,w)=>{try{if(w=w||{},!(y||w).priv){if(!r.I)throw"No signing key.";y=await r.I(null,{what:f,how:"sign",why:w.why})}if(l===f)throw"`undefined` not allowed.";var v=await a.parse(f),p=w.check=w.check||v;if(r.verify&&(r.opt.check(p)||p&&p.s&&p.m)&&l!==await r.verify(p,y)){var k=await a.parse(p);if(w.raw||(k="SEA"+await n.stringify(k)),g)try{g(k)}catch(S){console.log(S)}return k}var i=y.pub,c=y.priv,d=a.jwk(i,c),s=await h(v),m=await(n.ossl||n.subtle).importKey("jwk",d,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(b=>(n.ossl||n.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},b,new Uint8Array(s))),k={m:v,s:n.Buffer.from(m,"binary").toString(w.encode||"base64")};if(w.raw||(k="SEA"+await n.stringify(k)),g)try{g(k)}catch(b){console.log(b)}return k}catch(b){if(console.log(b),r.err=b,r.throw)throw b;g&&g();return}}),u.exports=r.sign})(e,"./sign"),e(function(u){var r=e("./root"),n=e("./shim"),a=e("./settings"),h=e("./sha256"),l;r.verify=r.verify||(async(g,w,v,p)=>{try{var i=await a.parse(g);if(w===!1){var c=await a.parse(i.m);if(v)try{v(c)}catch(T){console.log(T)}return c}p=p||{};var d=w.pub||w,s=r.opt.slow_leak?await r.opt.slow_leak(d):await(n.ossl||n.subtle).importKey("jwk",a.jwk(d),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),m=await h(i.m),k,b,S,A;try{if(k=n.Buffer.from(i.s,p.encode||"base64"),b=new Uint8Array(k),S=await(n.ossl||n.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},s,b,new Uint8Array(m)),!S)throw"Signature did not match."}catch{if(r.opt.fallback)return await r.opt.fall_verify(g,w,v,p)}var _=S?await a.parse(i.m):l;if(v)try{v(_)}catch(T){console.log(T)}return _}catch(T){if(console.log(T),r.err=T,r.throw)throw T;v&&v();return}}),u.exports=r.verify;var f={};r.opt.slow_leak=g=>{if(f[g])return f[g];var w=a.jwk(g);return f[g]=(n.ossl||n.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),f[g]};var y=r.opt;r.opt.fall_verify=async function(g,w,v,p,i){if(i===r.opt.fallback)throw"Signature did not match";i=i||1;var c=g||"";g=r.opt.unpack(g)||g;var d=await a.parse(g),s=w.pub||w,m=await r.opt.slow_leak(s),k=i<=r.opt.fallback?n.Buffer.from(await n.subtle.digest({name:"SHA-256"},new n.TextEncoder().encode(await a.parse(d.m)))):await h(d.m),b,S,A;try{if(b=n.Buffer.from(d.s,p.encode||"base64"),S=new Uint8Array(b),A=await(n.ossl||n.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},m,S,new Uint8Array(k)),!A)throw"Signature did not match."}catch{try{b=n.Buffer.from(d.s,"utf8"),S=new Uint8Array(b),A=await(n.ossl||n.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},m,S,new Uint8Array(k))}catch{if(!A)throw"Signature did not match."}}var _=A?await a.parse(d.m):l;if(y.fall_soul=c["#"],y.fall_key=c["."],y.fall_val=g,y.fall_state=c[">"],v)try{v(_)}catch(T){console.log(T)}return _},r.opt.fallback=2})(e,"./verify"),e(function(u){var r=e("./shim"),n=e("./settings"),a=e("./sha256");const h=async(l,f,y)=>{const g=l+(f||r.random(8)).toString("utf8"),w=r.Buffer.from(await a(g),"binary"),v=n.keyToJwk(w);return await r.subtle.importKey("jwk",v,{name:"AES-GCM"},!1,["encrypt","decrypt"])};u.exports=h})(e,"./aeskey"),e(function(u){var r=e("./root"),n=e("./shim");e("./settings");var a=e("./aeskey"),h;r.encrypt=r.encrypt||(async(l,f,y,g)=>{try{g=g||{};var w=(f||g).epriv||f;if(h===l)throw"`undefined` not allowed.";if(!w){if(!r.I)throw"No encryption key.";f=await r.I(null,{what:l,how:"encrypt",why:g.why}),w=f.epriv||f}var v=typeof l=="string"?l:await n.stringify(l),p={s:n.random(9),iv:n.random(15)},i=await a(w,p.s,g).then(d=>n.subtle.encrypt({name:g.name||"AES-GCM",iv:new Uint8Array(p.iv)},d,new n.TextEncoder().encode(v))),c={ct:n.Buffer.from(i,"binary").toString(g.encode||"base64"),iv:p.iv.toString(g.encode||"base64"),s:p.s.toString(g.encode||"base64")};if(g.raw||(c="SEA"+await n.stringify(c)),y)try{y(c)}catch(d){console.log(d)}return c}catch(d){if(console.log(d),r.err=d,r.throw)throw d;y&&y();return}}),u.exports=r.encrypt})(e,"./encrypt"),e(function(u){var r=e("./root"),n=e("./shim"),a=e("./settings"),h=e("./aeskey");r.decrypt=r.decrypt||(async(l,f,y,g)=>{try{g=g||{};var w=(f||g).epriv||f;if(!w){if(!r.I)throw"No decryption key.";f=await r.I(null,{what:l,how:"decrypt",why:g.why}),w=f.epriv||f}var v=await a.parse(l),p,i,c;try{p=n.Buffer.from(v.s,g.encode||"base64"),i=n.Buffer.from(v.iv,g.encode||"base64"),c=n.Buffer.from(v.ct,g.encode||"base64");var d=await h(w,p,g).then(m=>n.subtle.decrypt({name:g.name||"AES-GCM",iv:new Uint8Array(i),tagLength:128},m,new Uint8Array(c)))}catch{if(g.encode==="utf8")throw"Could not decrypt";if(r.opt.fallback)return g.encode="utf8",await r.decrypt(l,f,y,g)}var s=await a.parse(new n.TextDecoder("utf8").decode(d));if(y)try{y(s)}catch(m){console.log(m)}return s}catch(m){if(console.log(m),r.err=m,r.throw)throw m;y&&y();return}}),u.exports=r.decrypt})(e,"./decrypt"),e(function(u){var r=e("./root"),n=e("./shim");e("./settings"),r.secret=r.secret||(async(h,l,f,y)=>{try{if(y=y||{},!l||!l.epriv||!l.epub){if(!r.I)throw"No secret mix.";l=await r.I(null,{what:h,how:"secret",why:y.why})}var g=h.epub||h,w=l.epub,v=l.epriv,p=n.ossl||n.subtle,i=a(g),c=Object.assign({public:await p.importKey(...i,!0,[])},{name:"ECDH",namedCurve:"P-256"}),d=a(w,v),s=await p.importKey(...d,!1,["deriveBits"]).then(async k=>{var b=await p.deriveBits(c,k,256),S=new Uint8Array(b),A=await p.importKey("raw",S,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return p.exportKey("jwk",A).then(({k:_})=>_)}),m=s;if(f)try{f(m)}catch(k){console.log(k)}return m}catch(k){if(console.log(k),r.err=k,r.throw)throw k;f&&f();return}});var a=(h,l)=>{var[f,y]=h.split("."),g=l?{d:l}:{};return["jwk",Object.assign(g,{x:f,y,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};u.exports=r.secret})(e,"./secret"),e(function(u){var r=e("./root");r.certify=r.certify||(async(n,a={},h,l,f={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),n=(()=>{var m=[];if(n){if((typeof n=="string"||Array.isArray(n))&&n.indexOf("*")>-1)return"*";if(typeof n=="string")return n;if(Array.isArray(n)){if(n.length===1&&n[0])return typeof n[0]=="object"&&n[0].pub?n[0].pub:typeof n[0]=="string"?n[0]:null;n.map(k=>{typeof k=="string"?m.push(k):typeof k=="object"&&k.pub&&m.push(k.pub)})}return typeof n=="object"&&n.pub?n.pub:m.length>0?m:null}})(),!n)return console.log("No certificant found.");const g=f.expiry&&(typeof f.expiry=="number"||typeof f.expiry=="string")?parseFloat(f.expiry):null,w=(a||{}).read?a.read:null,v=(a||{}).write?a.write:typeof a=="string"||Array.isArray(a)||a["+"]||a["#"]||a["."]||a["="]||a["*"]||a[">"]||a["<"]?a:null,p=(f||{}).block||(f||{}).blacklist||(f||{}).ban||{},i=p.read&&(typeof p.read=="string"||(p.read||{})["#"])?p.read:null,c=typeof p=="string"?p:p.write&&(typeof p.write=="string"||p.write["#"])?p.write:null;if(!w&&!v)return console.log("No policy found.");const d=JSON.stringify({c:n,...g?{e:g}:{},...w?{r:w}:{},...v?{w:v}:{},...i?{rb:i}:{},...c?{wb:c}:{}});var y=await r.sign(d,h,null,{raw:1});if(f.raw||(y="SEA"+JSON.stringify(y)),l)try{l(y)}catch(m){console.log(m)}return y}catch(g){if(r.err=g,r.throw)throw g;l&&l();return}}),u.exports=r.certify})(e,"./certify"),e(function(u){var r=e("./shim"),n=e("./root");n.work=e("./work"),n.sign=e("./sign"),n.verify=e("./verify"),n.encrypt=e("./encrypt"),n.decrypt=e("./decrypt"),n.certify=e("./certify"),n.random=n.random||r.random,n.Buffer=n.Buffer||e("./buffer"),n.keyid=n.keyid||(async a=>{try{const h=r.Buffer.concat(a.replace(/-/g,"+").replace(/_/g,"/").split(".").map(g=>r.Buffer.from(g,"base64"))),l=r.Buffer.concat([r.Buffer.from([153,h.length/256,h.length%256]),h]),f=await sha1hash(l),y=r.Buffer.from(f,"binary");return y.toString("hex",y.length-8)}catch(h){throw console.log(h),h}}),((n.window||{}).GUN||{}).SEA=n,u.exports=n})(e,"./sea"),e(function(u){var r=e("./sea"),n,a;r.window?n=r.window.GUN||{chain:{}}:n=e((a+""==typeof o?".":"")+"./gun",1),r.GUN=n;function h(f){this._={$:this}}h.prototype=function(){function f(){}return f.prototype=n.chain,new f}(),h.prototype.constructor=h,n.chain.user=function(f){var y=this,w=y.back(-1),g;if(f)return f=r.opt.pub((f._||"")["#"])||f,w.get("~"+f);if(g=w.back("user"))return g;var w=w._,v=w,p=v.opt.uuid||l;return(v=(g=v.user=y.chain(new h))._).opt={},v.opt.uuid=function(i){var c=p(),d=w.user;return!d||!(d=d.is)||!(d=d.pub)||(c="~"+d+"/"+c,i&&i.call&&i(null,c)),c},g};function l(){return n.state().toString(36).replace(".","")}n.User=h,h.GUN=n,h.SEA=n.SEA=r,u.exports=h})(e,"./user"),e(function(u){var r,n=""+r!=typeof GUN?GUN||{chain:{}}:e((""+r==typeof o?".":"")+"./gun",1);n.chain.then=function(a,h){var l=this,f=new Promise(function(y,g){l.once(y,h)});return a?f.then(a):f}})(e,"./then"),e(function(u){var r=e("./user"),n=r.SEA,a=r.GUN,h=function(){};r.prototype.create=function(...l){var f=typeof l[0]=="object"&&(l[0].pub||l[0].epub)?l[0]:typeof l[1]=="object"&&(l[1].pub||l[1].epub)?l[1]:null,y=f&&(f.pub||f.epub)?f.pub:typeof l[0]=="string"?l[0]:null,g=f&&(f.pub||f.epub)?f:y&&typeof l[1]=="string"?l[1]:null,w=l.filter(m=>typeof m=="function")[0]||null,v=l&&l.length>1&&typeof l[l.length-1]=="object"?l[l.length-1]:{},p=this,i=p._,c=p.back(-1);if(w=w||h,v=v||{},v.check!==!1){var d;if(y||(d="No user."),(g||"").length<8&&(d="Password too short!"),d)return w({err:a.log(d)}),p}if(i.ing)return(w||h)({err:a.log("User is already being created or authenticated!"),wait:!0}),p;i.ing=!0;var s={};return s.a=function(m){if(s.pubs=m,m&&!v.already){var k={err:a.log("User already created!")};i.ing=!1,(w||h)(k),p.leave();return}s.salt=String.random(64),n.work(g,s.salt,s.b)},s.b=function(m){s.proof=m,f?s.c(f):n.pair(s.c)},s.c=function(m){var k;s.pair=m||{},(k=i.root.user)&&(k._.sea=m,k.is={pub:m.pub,epub:m.epub,alias:y}),s.data={pub:m.pub},s.d()},s.d=function(){s.data.alias=y,s.e()},s.e=function(){s.data.epub=s.pair.epub,n.encrypt({priv:s.pair.priv,epriv:s.pair.epriv},s.proof,s.f,{raw:1})},s.f=function(m){s.data.auth=JSON.stringify({ek:m,s:s.salt}),s.g(s.data.auth)},s.g=function(m){var k;s.data.auth=s.data.auth||m,c.get(k="~"+s.pair.pub).put(s.data).on(s.h);var b={};b[k]={"#":k},c.get("~@"+y).put(b).get(k).on(s.i)},s.h=function(m,k,b,S){S.off(),s.h.ok=1,s.i()},s.i=function(m,k,b,S){S&&(s.i.ok=1,S.off()),!(!s.h.ok||!s.i.ok)&&(i.ing=!1,w({ok:0,pub:s.pair.pub}),h===w&&(f?p.auth(f):p.auth(y,g)))},c.get("~@"+y).once(s.a),p},r.prototype.leave=function(l,f){var y=this,g=y.back(-1)._.user;if(g&&(delete g.is,delete g._.is,delete g._.sea),n.window)try{var w={};w=n.window.sessionStorage,delete w.recall,delete w.pair}catch{}return y}})(e,"./create"),e(function(u){var r=e("./user"),n=r.SEA,a=r.GUN,h=function(){};r.prototype.auth=function(...f){var y=typeof f[0]=="object"&&(f[0].pub||f[0].epub)?f[0]:typeof f[1]=="object"&&(f[1].pub||f[1].epub)?f[1]:null,g=!y&&typeof f[0]=="string"?f[0]:null,w=(g||y&&!(y.priv&&y.epriv))&&typeof f[1]=="string"?f[1]:null,v=f.filter(b=>typeof b=="function")[0]||null,p=f&&f.length>1&&typeof f[f.length-1]=="object"?f[f.length-1]:{},i=this,c=i._,d=i.back(-1);if(c.ing)return(v||h)({err:a.log("User is already being created or authenticated!"),wait:!0}),i;c.ing=!0;var s={},m,k=9;return s.a=function(b){if(!b)return s.b();if(!b.pub){var S=[];return Object.keys(b).forEach(function(A){A!="_"&&S.push(b[A])}),s.b(S)}if(s.name)return s.f(b);s.c((s.data=b).auth)},s.b=function(b){var S=(s.list=(s.list||[]).concat(b||[])).shift();if(m===S){if(s.name)return s.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(g&&k--){d.get("~@"+g).once(s.a);return}return s.err("Wrong user or password.")}d.get(S).once(s.a)},s.c=function(b){if(m===b)return s.b();if(typeof b=="string")return s.c(l(b));n.work(w,(s.auth=b).s,s.d,s.enc)},s.d=function(b){n.decrypt(s.auth.ek,b,s.e,s.enc)},s.e=function(b){if(m===b)return s.enc?(s.enc=null,s.b()):(s.enc={encode:"utf8"},s.c(s.auth));s.half=b,s.f(s.data)},s.f=function(b){var S=s.half||{},A=s.data||{};s.g(s.lol={pub:b.pub||A.pub,epub:b.epub||A.epub,priv:b.priv||S.priv,epriv:b.epriv||S.epriv})},s.g=function(b){if(!b||!b.pub||!b.epub)return s.b();s.pair=b;var S=d._.user,A=S._;A.tag;var _=A.opt;A=S._=d.get("~"+b.pub)._,A.opt=_,S.is={pub:b.pub,epub:b.epub,alias:g||b.pub},A.sea=s.pair,c.ing=!1;try{w&&m==(l(c.root.graph["~"+b.pub].auth)||"")[":"]&&(p.shuffle=p.change=w)}catch{}if(p.change?s.z():(v||h)(A),n.window&&(i.back("user")._.opt||p).remember)try{var T={};T=n.window.sessionStorage,T.recall=!0,T.pair=JSON.stringify(b)}catch{}try{d._.tag.auth?d._.on("auth",A):setTimeout(function(){d._.on("auth",A)},1)}catch(O){a.log("Your 'auth' callback crashed with:",O)}},s.h=function(b){if(!b)return s.b();if(g=b.alias,g||(g=b.alias="~"+y.pub),!b.auth)return s.g(y);y=null,s.c((s.data=b).auth)},s.z=function(){s.salt=String.random(64),n.work(p.change,s.salt,s.y)},s.y=function(b){n.encrypt({priv:s.pair.priv,epriv:s.pair.epriv},b,s.x,{raw:1})},s.x=function(b){s.w(JSON.stringify({ek:b,s:s.salt}))},s.w=function(b){if(p.shuffle){console.log("migrate core account from UTF8 & shuffle");var S={};Object.keys(s.data).forEach(function(A){S[A]=s.data[A]}),delete S._,S.auth=b,d.get("~"+s.pair.pub).put(S)}d.get("~"+s.pair.pub).get("auth").put(b,v||h)},s.err=function(b){var S={err:a.log(b||"User cannot be found!")};c.ing=!1,(v||h)(S)},s.plugin=function(b){if(!(s.name=b))return s.err();var S=[b];b[0]!=="~"&&(S[1]="~"+b,S[2]="~@"+b),s.b(S)},y?y.priv&&y.epriv?s.g(y):d.get("~"+y.pub).once(s.h):g?d.get("~@"+g).once(s.a):!g&&!w&&n.name(s.plugin),i};function l(f){if(typeof f!="string")return f;try{f=JSON.parse(f)}catch{f={}}return f}})(e,"./auth"),e(function(u){var r=e("./user"),n=r.SEA;r.GUN,r.prototype.recall=function(a,h){var l=this,f=l.back(-1);if(a=a||{},a&&a.sessionStorage){if(n.window)try{var y={};y=n.window.sessionStorage,y&&(f._.opt.remember=!0,(l.back("user")._.opt||a).remember=!0,(y.recall||y.pair)&&f.user().auth(JSON.parse(y.pair),h))}catch{}return l}return l}})(e,"./recall"),e(function(u){var r=e("./user"),n=r.SEA,a=r.GUN,h=function(){};r.prototype.pair=function(){var l=this,f;try{f=new Proxy({DANGER:""},{get:function(y,g,w){if(!(!l.is||!(l._||"").sea))return l._.sea[g]}})}catch{}return f},r.prototype.delete=async function(l,f,y){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var g=this;g.back(-1);var w=g.back("user");try{w.auth(l,f,function(v){var p=(w.is||{}).pub;w.map().once(function(){this.put(null)}),w.leave(),(y||h)({ok:0})})}catch(v){a.log("User.delete failed! Error:",v)}return g},r.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const l=this.back(-1);try{return await authRecall(l),l._.user._}catch{const y="No session!";throw a.log(y),{err:y}}},r.prototype.trust=async function(l){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),a.is(l)&&l.get("pub").get((f,y)=>{console.log(f,y)}),l.get("trust").get(path).put(theirPubkey)},r.prototype.grant=function(l,f){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var y=this,g=y.back(-1).user(),w=g._.sea,v="";return y.back(function(p){p.is||(v+=p.get||"")}),async function(){var p,i=await g.get("grant").get(w.pub).get(v).then();i=await n.decrypt(i,w),i||(i=n.random(16).toString(),p=await n.encrypt(i,w),g.get("grant").get(w.pub).get(v).put(p));var c=l.get("pub").then(),d=l.get("epub").then();c=await c,d=await d;var s=await n.secret(d,w);p=await n.encrypt(i,s),g.get("grant").get(c).get(v).put(p,f)}(),y},r.prototype.secret=function(l,f){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var y=this,g=y.back(-1).user(),w=g.pair(),v="";return y.back(function(p){p.is||(v+=p.get||"")}),async function(){var p,i=await g.get("trust").get(w.pub).get(v).then();i=await n.decrypt(i,w),i||(i=n.random(16).toString(),p=await n.encrypt(i,w),g.get("trust").get(w.pub).get(v).put(p)),p=await n.encrypt(l,i),y.put(p,f)}(),y},u.exports=r})(e,"./share"),e(function(u){var r=e("./sea"),n=e("./settings"),a,h=(r.window||"").GUN||e((""+a==typeof o?".":"")+"./gun",1);h.on("opt",function(p){p.sea||(p.sea={own:{}},p.on("put",l,p)),this.to.next(p)});function l(p){var i=this,c=i.as,d=p.put,s=d["#"],m=d["."],k=d[":"],b=d[">"],S=p["#"],A;if(!(!s||!m)){if((p._||"").faith&&(c.opt||"").faith&&typeof p._=="function"){r.opt.pack(d,function(T){r.verify(T,!1,function(O){d["="]=r.opt.unpack(O),i.to.next(p)})});return}var _=function(T){c.on("in",{"@":S,err:p.err=T})};if((p._||"").DBG&&((p._||"").DBG.c=+new Date),0<=s.indexOf("<?")&&(A=parseFloat(s.split("<?")[1]||""),A&&b<h.state()-A*1e3)){(A=p._)&&A.stun&&A.stun--;return}if(s==="~@"){l.alias(i,p,k,m,s,c,_);return}if(s.slice(0,2)==="~@"){l.pubs(i,p,k,m,s,c,_);return}if(A=r.opt.pub(s)){l.pub(i,p,k,m,s,c,_,c.user||"",A);return}if(0<=s.indexOf("#")){l.hash(i,p,k,m,s,c,_);return}l.any(i,p,k,m,s,c,_,c.user||"")}}l.hash=function(p,i,c,d,s,m,k){r.work(c,null,function(b){function S(A){let _="";for(let T=0;T<A.length;T++)_+=T-1&1?"":String.fromCharCode(parseInt(A.substring(T-1,T+1),16));return btoa(_)}if(b&&b===d.split("#").slice(-1)[0])return p.to.next(i);if(b&&b===S(d.split("#").slice(-1)[0]))return p.to.next(i);k("Data hash not same as hash!")},{name:"SHA-256"})},l.alias=function(p,i,c,d,s,m,k){if(!c)return k("Data must exist!");if("~@"+d===y(c))return p.to.next(i);k("Alias not same!")},l.pubs=function(p,i,c,d,s,m,k){if(!c)return k("Alias must exist!");if(d===y(c))return p.to.next(i);k("Alias not same!")},l.pub=async function(p,i,c,d,s,m,k,b,S){var A;const _=await n.parse(c)||{},T=(O,j,E)=>{if(O.m&&O.s&&j&&S)return r.verify(O,S,D=>{if(a!==D&&a!==D.e&&i.put[">"]&&i.put[">"]>parseFloat(D.e))return k("Certificate expired.");if(a!==D&&D.c&&D.w&&(D.c===j||D.c.indexOf("*")>-1)){let B=s.indexOf("/")>-1?s.replace(s.substring(0,s.indexOf("/")+1),""):"";String.match=String.match||h.text.match;const H=Array.isArray(D.w)?D.w:typeof D.w=="object"||typeof D.w=="string"?[D.w]:[];for(const P of H)if(String.match(B,P["#"])&&String.match(d,P["."])||!P["."]&&String.match(B,P["#"])||!P["#"]&&String.match(d,P["."])||String.match(B?B+"/"+d:d,P["#"]||P)){if(P["+"]&&P["+"].indexOf("*")>-1&&B&&B.indexOf(j)==-1&&d.indexOf(j)==-1)return k(`Path "${B}" or key "${d}" must contain string "${j}".`);if(D.wb&&(typeof D.wb=="string"||(D.wb||{})["#"])){var N=p.as.root.$.back(-1);return typeof D.wb=="string"&&D.wb.slice(0,1)!=="~"&&(N=N.get("~"+S)),N.get(D.wb).get(j).once(te=>te&&(te===1||te===!0)?k(`Certificant ${j} blocked.`):E(D))}return E(D)}return k("Certificate verification fail.")}})};if(d==="pub"&&"~"+S===s)return c===S?p.to.next(i):k("Account not same!");if((A=b.is)&&A.pub&&!_["*"]&&!_["+"]&&(S===A.pub||S!==A.pub&&((i._.msg||{}).opt||{}).cert)){r.opt.pack(i.put,O=>{r.sign(O,b._.sea,async function(j){if(a===j)return k(r.err||"Signature fail.");if(i.put[":"]={":":A=r.opt.unpack(j.m),"~":j.s},i.put["="]=A,S===b.is.pub){(A=y(c))&&((m.sea.own[A]=m.sea.own[A]||{})[S]=1),JSON.stringifyAsync(i.put[":"],function(E,D){return E?k(E||"Stringify error."):(i.put[":"]=D,p.to.next(i))});return}if(S!==b.is.pub&&((i._.msg||{}).opt||{}).cert){const E=await n.parse(i._.msg.opt.cert);E&&E.m&&E.s&&T(E,b.is.pub,D=>{i.put[":"]["+"]=E,i.put[":"]["*"]=b.is.pub,JSON.stringifyAsync(i.put[":"],function(N,B){return N?k(N||"Stringify error."):(i.put[":"]=B,p.to.next(i))})})}},{raw:1})});return}r.opt.pack(i.put,O=>{r.verify(O,_["*"]||S,function(j){var E;if(j=r.opt.unpack(j),a===j)return k("Unverified data.");if((E=y(j))&&S===r.opt.pub(E)&&((m.sea.own[E]=m.sea.own[E]||{})[S]=1),_["+"]&&_["+"].m&&_["+"].s&&_["*"])T(_["+"],_["*"],D=>(i.put["="]=j,p.to.next(i)));else return i.put["="]=j,p.to.next(i)})})},l.any=function(p,i,c,d,s,m,k,b){if(m.opt.secure)return k("Soul missing public key at '"+d+"'.");m.on("secure",function(S){if(this.off(),!m.opt.secure)return p.to.next(S);k("Data cannot be changed.")}).on.on("secure",i)};var f=h.valid,y=function(p,i){return typeof(i=f(p))=="string"&&i};(h.state||"").ify;var g=/[^\w_-]/;r.opt.pub=function(p){if(p&&(p=p.split("~"),!(!p||!(p=p[1]))&&(p=p.split(g).slice(0,2),!(!p||p.length!=2)&&(p[0]||"")[0]!=="@")))return p=p.slice(0,2).join("."),p},r.opt.stringy=function(p){},r.opt.pack=function(p,i,c,d,s){var m,k;if(r.opt.check(p))return i(p);p&&p["#"]&&p["."]&&p[">"]&&(m=p[":"],k=1),JSON.parseAsync(k?m:p,function(b,S){var A=a!==(S||"")[":"]&&(S||"")["~"];if(!A){i(p);return}i({m:{"#":s||p["#"],".":c||p["."],":":(S||"")[":"],">":p[">"]||h.state.is(d,c)},s:A})})};var w=r.opt;r.opt.unpack=function(p,i,c){var d;if(a!==p){if(p&&a!==(d=p[":"]))return d;if(i=i||w.fall_key,!c&&w.fall_val&&(c={},c[i]=w.fall_val),!(!i||!c)){if(p===c[i]||!r.opt.check(c[i]))return p;var s=c&&c._&&c._["#"]||w.fall_soul,m=h.state.is(c,i)||w.fall_state;if(p&&p.length===4&&s===p[0]&&i===p[1]&&v(m)===v(p[3]))return p[2];if(m<r.opt.shuffle_attack)return p}}},r.opt.shuffle_attack=15463296e5;var v=Math.floor})(e,"./index")})()})(se);var Ot=se.exports;const Ct=Tt(Ot),Dt=["http://localhost:8765/gun","https://gun-manhattan.herokuapp.com/gun"],Et=xt({peers:Dt,localStorage:!1}),jt=Et.user();jt.recall({sessionStorage:!0});function Bt(t,e,o,u,r,n){function a(){document.getElementById("pageMessages").hasChildNodes()}const h=["alert","animated","alertin"];h.push(`alert-${u.toLowerCase()}`),r&&h.push("alert-dismissible");const l=document.createElement("div");if(l.setAttribute("class",h.join(" ")),t){const f=document.createElement("h4");f.innerHTML=t,l.appendChild(f)}if(e){const f=document.createElement("strong");f.innerHTML=e,l.appendChild(f)}if(o){const f=document.createElement("p");f.innerHTML=o,l.appendChild(f)}if(r){const f=document.createElement("span");f.setAttribute("class","close"),f.setAttribute("data-dismiss","alert"),f.innerHTML="<i class='zmdi zmdi-close-circle-o'></i>",f.onclick=()=>{l.remove(),a()},l.appendChild(f)}document.getElementById("pageMessages").prepend(l),n&&setTimeout(()=>{l.classList.add("alertout"),setTimeout(()=>{l.remove(),a()},1e3)},3e3),a()}export{Ct as S,Bt as c,Et as g,jt as u};
